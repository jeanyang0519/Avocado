<!DOCTYPE html>

<meta charset="utf-8">

<head>
    <title>Hello Avocado</title>
    <link rel="icon" href="src/public/favicon.ico" />

    <link rel="stylesheet" href="./dist/main.css">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Bree+Serif&display=swap" rel="stylesheet">
    
    <!-- data files -->
    <script src="lib/imports.js" charset="utf-8"></script>
    <script src="lib/exports.js" charset="utf-8"></script>
    <!-- <script src="lib/volume.js" charset="utf-8"></script> -->
    

<!-- time d3-time-format -->
    <script src="https://d3js.org/d3-time.v1.min.js"></script>
    <script src="https://d3js.org/d3-time-format.v2.min.js"></script>
</head>


<body class="all">
    <div class="header">
        <div class="header-left">
            <img src="assets/images/avocado-icon.png">
            <p>Hello Avocado</p>
        </div>
        

    </div>
    
    <div class="parallax-1">

        <!-- <img class="background" src="assets/images/whitebackground.png" alt=""> -->
        <div class="info">
            <div class="info-title">Bravocado!</div>
            <div class="discription">Avocado is the new hot healthy superfood. You can see avocados everywhere - guacamole dips at your friend's party,
            delicious salads at your parents' table, and of course avocado toast at the overpriced hipster coffee shop.</div>
        </div>
    </div>
    
    
    <div class='content'>
        
        <!-- <form action=""></form> -->

        <div id='layout'>
            <div class='imports-exports' id='container'>
                <svg id='imports'></svg>
                <svg id='exports'></svg>
            </div>
        </div>

        


    </div>

    <div class="parallax-2">

    </div>

    <div class="lollipop">
        <span>Global Avocado Production</span>

        <div class="volume-wrapper">
            <div id="volume"></div>
        </div>

        <div class="lollipop-buttons">
            <button onclick="update('California')">California</button>
            <button onclick="update('Chile')">Chile</button>
            <button onclick="update('Mexico')">Mexico</button>
            <button id='peru-button'>Peru</button>
            
        </div>
        
        
    </div>
    <!-- Change the image later -->
    <div class="parallax-2">
    
    </div>

    <div class="author">
        
        <img src="assets/images/profile1.jpg" alt="">
        <div class="author-info">
            <p>Created By</p>
            <span>Jean Yang</span>
            <p>Software Engineer based in New York</p>
            <div class="icons">
                <a href="https://www.linkedin.com/in/jeanyang-engineer/">
                    <img src="assets/images/linkedin.png" alt="">
                </a>
                <a href="https://github.com/jeanyang0519">
                    <img src="assets/images/github.png" alt="">
                </a>
                <a href="https://angel.co/jean-yang-5">
                    <img src="assets/images/angellist.png" alt="">
                </a>
            </div>
        </div>
        
    </div>

<!-- Create another file!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->

    <script>
        // set the dimensions and margins of the graph
            var margin = { top: 60, right: 60, bottom: 140, left: 120 },
                    width = 1400 - margin.left - margin.right,
                    height = 700 - margin.top - margin.bottom;


                    

                // append the svg object to the body of the page
                var svg = d3.select("#volume")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform",
                        "translate(" + margin.left  + "," + margin.top + ")");

                // Initialize the X axis
                var x = d3.scaleBand()
                    .range([0, width])
                    .padding(1);
                var xAxis = svg.append("g")
                    .attr("transform", "translate(0," + height + ")")

                // Initialize the Y axis
                var y = d3.scaleLinear()
                    .range([height, 0])
                    
                var yAxis = svg.append("g")
                    
                    
                    
                    function update(selectedVar) {
                        
                       
                        d3.csv("test.csv", function (data) {
                       
                        var parseDate = d3.timeParse("%b %d, %Y");
                        const formaDate = d3.timeFormat('%b-%d')
                        
                        data.forEach(function (d) {
                            d.Week = formaDate(parseDate(d.Week));
                            
                            
                        });
                        
                        x.domain(data.map(function (d) { return d.Week; }) )
                        xAxis.transition()
                            .duration(1000)
                            .call(d3.axisBottom(x))
                            .attr("transform", "translate(-0.2," + height + ")")
                            
                            .selectAll("text")
                            .attr("transform", "translate(-10,0)rotate(-45)")
                            .style("text-anchor", "end")
                            .attr('x', -8)
                            
                           
                        const maxY = d3.max(data, function (d) { 
                            return +d[selectedVar].split(',').join('')
                        })
                        
                        
                        y.domain([0, maxY]);
                        yAxis.transition().duration(1000).call(d3.axisLeft(y));

                       
                        
                        // variable u: map data to existing circle
                        var j = svg.selectAll(".myLine")
                            .data(data)
                            // update lines
                            
                            j.enter()
                            .append("line")
                            .attr("class", "myLine")
                            .merge(j)
                            .transition()
                            .duration(1000)
                            .attr("x1", function (d) { console.log(x(d.Week)); return x(d.Week); })
                            
                            .attr("x2", function (d) { return x(d.Week); })
                            .attr("y1", y(0))
                            .attr("y2", function (d) { return y(d[selectedVar].split(',').join('')); })
                            .attr('opacity', 0.5)
                            .attr("color", "red")

                            


                        
                        var u = svg.selectAll("circle")
                            .data(data)
                            u.enter()
                            .append("circle")
                            .merge(u)
                            .transition()
                            .duration(1000)
                            .attr("cx", function (d) { return x(d.Week) })
                            .attr("cy", function (d) { return y(d[selectedVar].split(',').join('')) })
                            .attr("r", 5)
                            .attr("fill", "darksalmon")


                        svg.selectAll("circle")
                            .on("mouseover", handleMouseOver)
                            .on("mouseout", handleMouseOut)
                            
                            function handleMouseOver(d, i) {
                                svg.append('text')
                                .attr('class', 'hoverVaule')
                                .attr("x", x(d.Week) - 20)
                                .attr('y', y(d[selectedVar].split(',').join('')) - 18)
                                .text(d[selectedVar])
                               

                                d3.select(this)
                                .attr('fill', "darkcyan")
                                .attr('r', 8)
                                
                                
                            }

                        function handleMouseOut(d, i) {
                            d3.select('.hoverVaule').remove();
                            d3.select(this)
                                .attr('fill', "darksalmon")
                                .attr('r', 5)
                        }


                         

                            

                        // svg.append("g")
                        //         .attr("transform", "translate(0," + height + ")")
                        //         .call(d3.axisBottom(x))
                        //         .selectAll("text")
                        //         .attr("transform", "translate(-10,0)rotate(-45)")
                        //         .style("text-anchor", "end");
                      

                        svg.append('text')
                                .attr('class', 'source')
                                .attr('x', width - 150)
                                .attr('y', height + 100)
                                .attr('text-anchor', 'start')
                                .text('Source: Hass Avocado Board, 2019')


                    })

                }

                // Initialize plot
                update('California')

                const button = document.getElementById('peru-button')
                button.addEventListener('click', () => update('Peru'))
    </script>
</body>
